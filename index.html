<!DOCTYPE html>
<html>
<head>
    <title>‚ù§Ô∏è Trouve ta moiti√© !</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .step { display: none; }
        .active { display: block; }
        input, button { width: 100%; padding: 10px; margin: 5px 0; box-sizing: border-box; }
        button { background: #e91e63; color: white; border: none; cursor: pointer; }
        .alert { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
    </style>
</head>
<body>
    <!-- √âtape 1 : Recherche du num√©ro -->
    <div id="step1" class="step active">
        <h2>üîç Num√©ro de c≈ìur</h2>
        <input type="number" id="heartNumber" placeholder="Entrez votre num√©ro">
        <button onclick="checkNumber()">V√©rifier</button>
    </div>

    <!-- √âtape 2 : Enregistrement -->
    <div id="step2" class="step">
        <h2>üìù Cr√©er votre compte</h2>
        <input type="password" id="password" placeholder="Choisissez un mot de passe">
        <input type="text" id="prenom" placeholder="Votre pr√©nom">
        <input type="text" id="classe" placeholder="Votre classe">
        <button onclick="register()">Valider</button>
    </div>

    <!-- √âtape 3 : Connexion -->
    <div id="step3" class="step">
        <h2>üîë Connexion</h2>
        <input type="password" id="loginPassword" placeholder="Votre mot de passe">
        <button onclick="login()">Se connecter</button>
    </div>

    <!-- R√©sultats -->
    <div id="result"></div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyLy_AOLdfNVqSB3_Sm9noO3NG1FcCMkUgVWoeH0BXRSM2GdEjqYgAebYY5Wf2VbDMv_Q/exec";
        let currentHeartNumber;

        async function checkNumber() {
            currentHeartNumber = document.getElementById('heartNumber').value;
            const response = await fetch(`${SCRIPT_URL}?action=check&heartNumber=${currentHeartNumber}`);
            const data = await response.json();
            
            if (data.count === 2) {
                showStep('step3');
            } else {
                showStep('step2');
            }
        }

        async function register() {
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({
                    action: 'register',
                    heartNumber: currentHeartNumber,
                    password: document.getElementById('password').value,
                    prenom: document.getElementById('prenom').value,
                    classe: document.getElementById('classe').value
                })
            });
            
            const result = await response.json();
            if (result.success) {
                showResult(result.status === 'second' ? 
                    "üéâ Votre jumeau est enregistr√© ! Connectez-vous" : 
                    "‚úÖ Premier compte cr√©√© !", 'success');
                showStep('step3');
            }
        }

        async function login() {
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({
                    action: 'login',
                    heartNumber: currentHeartNumber,
                    password: document.getElementById('loginPassword').value
                })
            });
            
            const result = await response.json();
            if (result.success) {
                if (result.partner) {
                    showResult(`‚ù§Ô∏è Votre moiti√© est ${result.partner.prenom} (${result.partner.classe})`, 'success');
                } else {
                    showResult("‚è≥ En attente de votre jumeau...", 'info');
                }
            } else {
                showResult(result.message, 'error');
            }
        }

        function showStep(stepId) {
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.getElementById(stepId).classList.add('active');
        }

        function showResult(message, type = 'info') {
            const colors = {
                success: '#4CAF50',
                error: '#f44336',
                info: '#2196F3'
            };
            document.getElementById('result').innerHTML = `
                <div class="alert" style="background-color: ${colors[type]}11; border-color: ${colors[type]}; color: ${colors[type]}">
                    ${message}
                </div>
            `;
        }
    </script>
</body>
</html>
